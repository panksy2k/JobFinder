language: java
jdk:
  - openjdk11
branches:
  only:
    - master

env:
  global:
    - HEROKU_APP_NAME=stuxnet-jobfinder
    - HEROKU_USERNAME=pankaj.d.p@gmail.com
    - HEROKU_API_KEY=a0f1e911-26f0-4f45-8078-345ec23f46ea
    - HEROKU_REGISTRY_DOCKER=registry.heroku.com
build:
  ci:
    - mvn clean package docker:build
  on_success:
    #- git push -f git@heroku.com:$HEROKU_APP_NAME.git master

  post_ci:
    - docker login --username=$HEROKU_USERNAME --password=$HEROKU_API_KEY $HEROKU_REGISTRY_DOCKER
    - if [ "$BRANCH" == "master" ]; then docker image tag jobfinder $HEROKU_REGISTRY_DOCKER/jobfinder:latest && docker image push $HEROKU_REGISTRY_DOCKER/jobfinder:latest; fi
    - heroku container:release web

integrations:
  hub:
    - integrationName: jobfinder-docker-registry
      type: dockerRegistryLogin
      branches:
        only:
          - master